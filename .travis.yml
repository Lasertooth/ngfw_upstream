sudo: required

git:
  depth: false

services:
- docker

env:
  global:
    - SSH_KEY: /tmp/travis-buildbot.rsa
  jobs:
    - REPOSITORY: stretch
      DISTRIBUTION: current
      PKGTOOLS_COMMIT: origin/master
      ARCHITECTURE: amd64
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: amd64
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: i386
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp

before_install:
- docker pull untangleinc/ngfw:${REPOSITORY}-build-${ARCHITECTURE}
- openssl aes-256-cbc -K $encrypted_43711b6157b7_key -iv $encrypted_43711b6157b7_iv -in .travis/buildbot.rsa.enc -out ${SSH_KEY} -d
- chmod 600 ${SSH_KEY}

script:
- docker-compose -f docker-compose.build.yml run pkgtools
- docker-compose -f docker-compose.build.yml run build

notifications:
  email: false
  slack:
    rooms:
      secure: "FaBSofPHb8OGi35f4nzIC4V56ugcQCp/4x93ltqBqMTHpJcnivgjvVB7gItU+NzQPTwNFcIPC8Lpvg1xhQu6ZvV/Q0oe+CpFDYY8xgK2VvZ+L/WyoTdh1E+GVbj8DXyW1IV8y+vGsA2a7T0yDucgYgecAhXpMw/0v0+Ie2t/mHqkxjC9GW6dVfVEgS0tmgsJ6KKen6FU6csO/I3HXw/hsRSaqml5T7496oYnlGQCL0wLIucUaueZQ+lkxNrlV2JItXT2q5y0MhVIIIF/qojMZYHItgggXcV5/ugFkhJGvnFqqdXw0HdezBx/r2vliRfmb5NrMakb/VLLYtY4NpP0+OYZJ9yTxzH9x2jXo4FijFgXraEARxxh74LFpI1dR9EMXUHHHft4KEQIOhGc0YtB/tVT7d/vYLDv4MpMQBZSwwpSktPxh4jCRFkm9vG4CqfH7WtQ8QguL7BHit412IVNxUO6vcq/f8kWnmex63paery3Zt7/YdqXtV3zYGelZdeBDBoqjO+ilEPgqJ/TDHR5WWwiaxuQJ8f1w8W2nUP83eFmnejXZ6qve447HDrn5woj9DqAqWGf58SrHB2NvcqDu1s+x8+gxViue7+Gf/Ww0Vej11ZVM4cCxAHDTZaRZhntTiNPuVLwGj5X7dZ/Z6epJyxNj5HnkUNmJda45UNP+Jc="
    on_success: change
    on_failure: always
